{% extends 'partials/optionsGame.html' %}
{% block content %}
<container id="gameOption">
<div class="content">
<div class="container py-5">
	<h1 class="mb-4-title">Options</h1>
	
	<div class="card mb-4">
		<div class="card-body">
			<h5 class="card-title">Joueurs</h5>
			<div id="players-container">
				<div class="player-input mb-3">
					<div class="input-group">
						<span class="input-group-text">Player 1</span>
						<input type="text"  class="form-control player" placeholder="Player name">
						<input type="color" class="form-control form-control-color" value="#ff0000" title="Choisir la couleur">
					</div>
				</div>
				<div class="player-input mb-3">
					<div class="input-group">
						<span class="input-group-text">Player 2</span>
						<input type="text"  class="form-control player" placeholder="Player name">
						<input type="color" class="form-control form-control-color" value="#0000ff" title="Choisir la couleur">
					</div>
				</div>
			</div>
			<div class="btn-group" role="group">
				<button class="btn btn-primary" onclick="addPlayer()">
					<i class="fas fa-plus"></i> Add player
				</button>
				<button class="btn btn-danger" onclick="removePlayer()">
					<i class="fas fa-minus"></i> Delete player
				</button>
			</div>
		</div>
	</div>
	
	<div class="card mb-4">
		<div class="card-body">
			<h5 class="card-title">Options de jeu</h5>
			<div class="form-check form-switch">
				<input class="form-check-input" type="checkbox" id="bonusSwitch">
				<label class="form-check-label" for="bonusSwitch">Activer les bonus</label>
			</div>
		</div>
	</div>
	
	<button class="btn btn-success btn-lg" hx-get="{% url 'game:bracket' %}" hx-target="#gameOption" hx-vals="js:{'players': shufflePlayer(), 'game': 'pong'}"
	 hx-swap="outerHTML">Start</button>
</div>
<script>
	function shufflePlayer() {
    let listPlayer = Array.from(document.querySelectorAll('.player'));
    // Convertir les inputs en objets joueurs
    listPlayer = Array.from(listPlayer).map((input, index) => ({
        name: input.value || 'Player' + (index + 1),
        score: [0, 0, 0, 0],
        round: 0,
		win : 0,
		loose : 0
    }));

    // Ajouter des IA si nécessaire pour avoir un nombre pair
    if (listPlayer.length % 2 !== 0) {
        for (let i = 0; i < Math.log2(listPlayer.length); i++) {
            listPlayer.push({
                name: 'IA' + (i + 1),
                score: [0, 0, 0, 0],
                round: 0,
				win : 0,
				loose : 0
            });
        }
    }

    // Mélanger la liste
    for (let i = listPlayer.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [listPlayer[i], listPlayer[j]] = [listPlayer[j], listPlayer[i]];
    }

    return JSON.stringify(listPlayer);
}
</script>
</container>
{% endblock content %}